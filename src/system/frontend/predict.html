<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="styles/predict.css" type="text/css" rel="stylesheet" />
    <link href="styles/share.css" type="text/css" rel="stylesheet" />
</head>

<body onload="drawAnimation()">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.2.1/dist/echarts.js"></script>
    <script src="https://unpkg.com/vue@next"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@0.12.0/dist/axios.min.js"></script>

    <section id="headerSection">
        <div id="inputDiv">
            <form id="steelInfoForm" @submit="checkForm"
                action="javascript:submitCastingPriorInfo(this)" method="post">
                <table style="border-spacing: 10px;">
                    <tr>
                        <td><span>{{steelType}}：</span></td>
                        <td><input class="boxText" id="steelTypeInput"></input></td>
                        <td><span>{{billetWidth}}：</span></td>
                        <td><input class="boxText" id="billetWidthInput"></input></td>
                        <td><span>{{billetThickness}}：</span></td>
                        <td><input class="boxText" id="billetThicknessInput"></input></td>
                        <td><input class="button text" type="submit" v-bind:value="predictButton"></input></td>

                    </tr>
                    <tr>
                        <td><span>{{castingWidth}}：</span></td>
                        <td><input class="boxText" id="castingWidthInput"></input></td>
                        <td><span>{{mode}}：</span></td>
                        <td><input class="boxText" id="modeInput"></input></td>
                        <td><span>{{targetLV}}：</span></td>
                        <td><input class="boxText" id="targetLVInput"></input></td>
                        <td><button class="button text">播放</button></td>
                    </tr>
                </table>
                <button class="button text" style="margin: 0px 0px 0px 10px;" onclick="javascript:openFileThroughPicker()">打开文件</button>
                <input class="button text" style="margin: 0px 0px 0px 10px; visibility: hidden;" id="openFileInput" type="file"
                    onchange="javascript:openFile(this)"></input>
                
            </form>
        </div>
    </section>
    <section id="animationSection">
        <div id="animationDiv">
            <canvas id="animationCanvas" v-bind:height="canvasHeight" v-bind:width="canvasWidth"></canvas>
        </div>
    </section>
    <section id="chartSection">
        <div id="echartDiv">
            
            <div v-for="(chartViewModel,index) in chartViewModels" class="echartContentDiv"
                v-show="chartViewModel.isSelected" v-bind:id="'echartContent' + chartViewModel.chartId">
            </div>
            <button id="updateButton" style="top: 35px; position:absolute">update</button>
        </div>
        <div id="tabDiv">
            <table>
                <ul id="tabRow">
                    <span style="float: right; margin: 5px;" onclick="closeTab()">❎</span>
                    <li v-for="(chartViewModel,index) in chartViewModels" @click="currentId=chartViewModel.chartId"
                        onclick="onTabClicked()" v-bind:class="{tabItemSelected:chartViewModel.isSelected}">
                        {{chartViewModel.title}}</li>
                </ul>
            </table>
        </div>
    </section>
    <!-- <section id="charSection"></section>
    <section id="mainSection">
        <div id="animationDiv"></div>
        <div id="chartDiv"></div>
    </section> -->
    <script src="src/predictView.js"></script>
    <script src="src/animationView.js"></script>
    <script src="src/lib/webgl-utils.js"></script>
    <script src="src/lib/webgl-debug.js"></script>
    <script src="src/lib/cuon-utils.js"></script>
    <script src="src/lib/cuon-matrix.js"></script>
    <script type="text/javascript">
        var currentChart = null;
        function generatingCastingChart(dataViewModel) {
            var divId = createEchartContentDiv(dataViewModel.title, dataViewModel.chartId)
            var echart = echarts.init(document.getElementById(divId));
            currentChart = echart
            dataViewModel.echart = echart;
            var option = {
                xAxis: {
                    type: 'category',
                    data: dataViewModel.data.times
                },
                yAxis: {
                    type: 'value',
                    min: -2
                },
                series: [
                    {
                        data: dataViewModel.data.values,
                        type: 'line'
                    }
                ],

                toolbox: {
                    show: true,
                    feature: {
                        mark: { show: true },
                        dataView: {
                            show: true,
                            readOnly: false,
                            //修改数据视图格式
                            optionToContent: function (opt) {
                                //修改数据视图代码最后贴出，此处不做过多展示
                            }
                        },
                        magicType: { show: true, type: ['line', 'bar'] },
                        restore: { show: true },
                        saveAsImage: { show: true },
                        dataZoom: {
                            show: true,
                        }
                    }
                }
            };

            echart.setOption(option)

            //_animationStarted = true;
        }

        function createEchartContentDiv(name, chartId) {
            var divId = "echartContent" + chartId;
            // Create tab page
            //var echartDiv = document.getElementById("echartDiv");
            //echartDiv.innerHTML = "<div class=\"echartContentDiv\" id=\""+divId+"\"></div>";
            return divId;
        }

        window.onresize = function () {
            resizeEverything();
        }
        
        function openFileThroughPicker()
        {
            var openFileButton = document.getElementById('openFileInput');
            openFileButton.click();
        }

        function resizeEverything() {

            for (var i = 0; i < chartCollectionViewModel.chartViewModels.length; ++i) {
                if (chartCollectionViewModel.chartViewModels[i].chartId == chartCollectionViewModel.currentId) {
                    if (chartCollectionViewModel.chartViewModels[i].echart != null) {
                        chartCollectionViewModel.chartViewModels[i].echart.resize();
                    }
                    break;
                }
            }

            var canvas = document.getElementById('animationCanvas');
            var canvasDiv = document.getElementById('animationDiv');
            // canvas.Height = canvasDiv.Height;
            //startAnimation()

            canvas.height = canvasDiv.clientHeight;
            canvas.width = canvasDiv.clientWidth;
        }

        function openFile() {
            var openFileInput = document.getElementById('openFileInput');
            var filePath = openFileInput.value;
            var filePaths = filePath.split('\\');
            var fileName = filePaths[filePaths.length - 1]
            submitCastingPriorInfo(null, fileName);
        }

        function closeTab() {
            var i = 0;
            var length = chartCollectionViewModel.chartViewModels.length;

            for (i = 0; i < length; ++i) {
                if (chartCollectionViewModel.chartViewModels[i].chartId == chartCollectionViewModel.currentId) {
                    var element = chartCollectionViewModel.chartViewModels[i];

                    if (element.echart != null) {
                        console.log("fuck you ")
                        element.echart.clear();
                        element.echart.dispose();
                    }

                    chartCollectionViewModel.chartViewModels.splice(i, 1);
                    break;
                }
            }

            if (length == 1) {
                chartCollectionViewModel.chartViewModels.push(defaultChartViewModel);
                chartCollectionViewModel.isEmpty = true;
            }
            else if (length == i + 1) {
                selectItem(chartCollectionViewModel.chartViewModels[i - 1].chartId);
            }
            else {
                selectItem(chartCollectionViewModel.chartViewModels[i].chartId);
            }
        }

        function fuck() {
            console.log("dfsdf")
        }
    </script>
</body>

</html>